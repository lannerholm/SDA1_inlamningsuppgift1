---
title: "Statistik och dataanalys I, 15 hp "
subtitle: "Inl칛mningsuppgift 1"
author: 
- Namn 1
- Namn 2
- Namn 3
date: last-modified
format: 
  html:
    self-contained: true
  pdf: default  
  docx: default
toc: true
language: 
  title-block-author-single: " "
toc-title-document: "Inneh친ll"
crossref-fig-title: "Figur"
theme: Superhero
title-block-banner-color: Primary
title-block-published: "Publicerad"
callout-warning-caption: "Varning"
callout-note-caption: "Observera"
callout-tip-caption: "Tips"
editor: visual
---

::: callout-warning
Den h칛r inl칛mningsuppgiften f칬ruts칛tter att f칬ljande paket finns installerade:

-   `mosaic`

-   `dplyr`

-   `geosphere`

-   `leaflet`

Paket kan installeras via kommandot `install.packages('packagename')`, d칛r `'packagename'` 칛r namnet p친 paketet, t.ex `'mosaic'`.
:::

## Introduktion

I den f칬rsta inl칛mningsuppgiften ska ni sj칛lvst칛ndigt i grupper om tre analysera ett dataset i programmeringsspr친ket R. Till skillnad fr친n datorlaborationerna finns det minimalt med kodexempel. Datorlaborationerna g친r igenom de flesta momenten som behandlas i inl칛mningsuppgiften, s친 se till att g칬ra klart dessa innan.

------------------------------------------------------------------------

::: callout-note
### Instruktioner

I denna inl칛mningsuppgift ska ni analysera ett datamaterial som inneh친ller en m칛ngd olika variabler fr친n en totalunders칬kning[^1] i Boston 1970 som aggregerats till ca 500 censusdistrikt. Datasetet f칬rekommer i m친nga olika varianter. H칛r anv칛nder vi en modifierad version[^2] av originaldata[^3] som anv칛nts i en studie[^4] d칛r f칬rfattarna predikterar medianhuspriset i ett censusdistrikt givet en upps칛ttning f칬rklarande variabler.

F칬ljande variabler finns i datasetet `boston_census_data.Rdata` ([ladda ner](https://github.com/StatisticsSU/SDA1/blob/main/assignments/assignment1/Boston_census_data.RData?raw=true)) f칬r 480 observationer. Notera att en observation motsvarar ett censusdistrikt:

-   `town`: Stadsdel.
-   `longitude`: Longitud koordinat.
-   `latitude`: Latitud koordinat.
-   `median_home_value`: Medianhuspriset (enhet 1K USD).
-   `crime_rate`: Brott (per 1000 inv친nare).
-   `zoned_25k_p`: Andel av stadsdelens bostadsmark 칛mnad f칬r marklotter st칬rre 칛n 25000 kvadratfot.
-   `indust_p`: Andel tunnland 칛gd av f칬retag utanf칬r detaljhandel.
-   `borders_charles`: Charles River dummy variabel (= 1 om omr친det gr칛nsar till floden, 0 annars).
-   `NOx`: Koncentration av kv칛veoxider (andelar per 10 miljon).
-   `n_rooms_avg`: Genomsnitt antal rum i 칛gda bost칛der.
-   `before_1940_p`: Andel 칛gda bost칛der byggda f칬re 1940.
-   `employ_dist`: Viktat avst친nd till fem arbetsf칬rmedlingscentra i Boston.
-   `radial_access`: Index som m칛ter tillg친ng till stadsmotorv칛gar.
-   `tax_rate`: Fastighetsskatt per 10000 USD.
-   `pupil_teacher_ratio`: L칛rart칛thet m칛tt som elev per l칛rare.
-   `lower_stat_pct`: Procentandel underklass definerad som en av tv친: (i) andel vuxna utan gymnasieutbildning eller (ii) andel m칛n som genomf칬r okvalificerat arbete.

Bland de f칬rklarande variablerna som anv칛nts i studien (ej med i datasetet) finns en icke-linj칛r interaktion av latitud och longitud koordinaterna f칬r att modellera medianhuspriset spatiellt (dvs deras modell anv칛nder censusdistriktens geografiska platser f칬r att f친nga den spatiella variationen i huspriser, dvs geografisk variation). Det h칛r s칛ttet att modellera spatiellt beroende 칛r 칬verkurs[^5], s친 ni kommer att f친 g칬ra f칬ljande f칬renkling f칬r att f친nga det geografiska beroendet i medianhuspriset. Genom att anv칛nda latitud och longitud koordinaterna kan ni ber칛kna avst친ndet till en central plats i Boston. Ni kan sedan inkludera detta avst친nd som en f칬rklarande variabel i en regressionsmodell, f칬r att se om den f칬rklarar variation i medianhuspriserna.

I sista uppgiften ska ni f칬resl친 en prognosmodell f칬r medianhuspriset d칛r ni f친r v칛lja vilka f칬rklaringsvariabler ni vill ha med (ni v친r v칛lja bland en delm칛ngd av de som listas ovanf칬r, se Uppgift 5.4). Ni ska sedan anv칛nda er modell f칬r att prognostisera medianhuspriset f칬r tio censusdistrikt i datasetet `boston_districts_to_predict.Rdata` ([ladda ner](https://github.com/StatisticsSU/SDA1/blob/main/assignments/assignment1/Boston_districts_to_predict.RData?raw=true)). Det h칛r datasetet har endast de f칬rklarande variablerna, dvs alla de variabler ni f친r anv칛nda f칬rutom medianhuspriset. N칛r vi r칛ttar era inl칛mningsuppgifter kommer vi att j칛mf칬ra prognoserna mot de faktiska v칛rden (vi har tillg친ng till dessa). De tre b칛sta prognosmakarna kommer att publiceras p친 hemsidan.

Inl칛mningsuppgiften ska l칛mnas in i form av ett html dokument genererat av Quarto. **Kontrollera noga att du inte har n친gra felmeddelande och att dokumentet kompileras utan problem**. Anv칛nd tydliga figurer och namnge axlarna med tydliga variabelnamn. Gl칬m inte att skriva era namn ovanf칬r ist칛llet f칬r Namn 1, Namn 2 och Namn 3.
:::

[^1]: Kallas f칬r census survey p친 engelska. En statistisk unders칬kning d칛r hela populationen unders칬ks.

[^2]: Totalunders칬kningen trunkerade medianhusv칛rdet till 50K f칬r de censusdistrikten som l친g 칬ver. Vi har tagit bort dessa censusdistrikt. Vi har ocks친 tagit bort variabler som 칛r irrelevanta.

[^3]: Harrison Jr, D., & Rubinfeld, D. L. (1978). Hedonic housing prices and the demand for clean air. Journal of Environmental Economics and Management, 5(1), 81-102.

[^4]: Pace, R. K., & Gilley, O. W. (1997). Using the spatial configuration of the data to improve estimation. The Journal of Real Estate Finance and Economics, 14(3), 333-340.

[^5]: Forts칛tt l칛sa Statistik och Dataanalys II s친 l칛r ni er hur man g칬r detta.

## 0. Ladda in data

#### 游눩 Uppgift 0.1

St칛ll in arbetsmappen samt ladda in dataseten `Boston_census_data.Rdata` och `Boston_districts_to_predict.Rdata` (l칛nkar f칬r att ladda ner data finns i Instruktioner avsnittet ovan).

::: {.callout-note appearance="minimal"}
# Uppgift 0.1 - Svar

```{r}
# Write your code here
load(file = url("https://github.com/StatisticsSU/SDA1/blob/main/assignments/assignment1/Boston_census_data.RData?raw=true")) 
```
:::

## 1. Kriminalitet i Boston

I detta avsnitt ska ni analysera kriminaliteten i Boston med hj칛lp av variabeln `crime_rate`.

#### 游눩 Uppgift 1.1

Vad kan man generellt s칛ga om kriminaliteten i censusdistrikten? Anv칛nd l칛mpliga figurer samt f칬rdelningsm친tt som underlag.

::: {.callout-note appearance="minimal"}
# Uppgift 1.1 - Svar

Skriv svaret h칛r. Vid behov skrivs matematiska symboler inom dollartecken, till exempel $\overline{y} = \sum^{n}_{i=1} y_i$. Koden skrivs i R-rutan nedanf칬r.

```{r}
# Write your code here
```
:::

#### 游눩 Uppgift 1.2

Varierar brottsligheten i Boston beroende p친 den kategoriska variabeln `town`? Det finns 88 olika utfall av `town` (dvs 88 olika stadsdelar). V칛lj ut `Boston East Boston`, `Boston Downtown`,`Cambridge`, samt tv친 valfria stadsdelar f칬r att besvara fr친gan. Fr친gan besvaras med hj칛lp av l칛mpligt valda figurer och statistiska m친tt.

::: callout-tip
Skapa en ny data frame som filtrerar `Boston_census_data` (till exempel genom `filter()` funktionen) utefter de stadsdelarna ni 칛r intresserade utav innan ni p친b칬rjar analysen.
:::

::: {.callout-note appearance="minimal"}
# Uppgift 1.2 - Svar

Skriv svaret h칛r.

```{r}
# Write your code here
```
:::

#### 游눩 Uppgift 1.3

Vilka tre variabler i datasetet `Boston_census_data` korrelerar mest med brottslighet? Beskriv det parvisa sambandet mellan brottslighet och vardera av dessa tre variabler.

::: callout-tip
Kom ih친g att korrelation 칛r ett beroendem친tt f칬r *numeriska variabler*.
:::

::: {.callout-note appearance="minimal"}
# Uppgift 1.3 - Svar

Skriv svaret h칛r.

```{r}
# Write your code here
```
:::

## 2. Fastighetsskatt i Boston

I detta avsnitt ska ni analysera fastighetsskatten i Boston med hj칛lp av variabeln `tax_rate`.

#### 游눩 Uppgift 2.1

Vad kan man generellt s칛ga om fastighetsskatten i censusdistrikten? Anv칛nd l칛mpliga figurer samt f칬rdelningsm친tt som underlag.

::: {.callout-note appearance="minimal"}
# Uppgift 2.1 - Svar

Skriv svaret h칛r.

```{r}
# Write your code here
```
:::

#### 游눩 Uppgift 2.2

L친t oss skapa en ny variabel `cat_tax` som anger om ett censusdistrikt betalar l친g (`low`), medel (`medium`), eller h칬g (`high`) fastighetsskatt. Vi definerar skattekategorierna enligt

-   `low`: `tax_rate` $\leq$ 250,
-   `medium`: 250 $<$ `tax_rate` $\leq$ 400,
-   `high`: `tax_rate` $>$ 400.

F칬ljande kod skapar och l칛gger till variabeln `cat_tax` i `Boston_census_data`

```{r}
Boston_census_data$cat_tax <- cut(Boston_census_data$tax_rate, 
              breaks=c(0, 250, 400, 800),
              labels=c('Low', 'Medium', 'High'))
```

Finns det ett samband mellan vilken skattekategori ett censusdistrikt tillh칬r och dess angr칛nsning till Charles River? F칬rklara med hj칛lp av l칛mplig tabell samt figur.

::: {.callout-note appearance="minimal"}
# Uppgift 2.2 - Svar

Skriv svaret h칛r.

```{r}
# Write your code here
```
:::

#### 游눩 Uppgift 2.3

Hur m친nga procent av alla censusdistrikt ligger i angr칛nsning till Charles River och tillh칬r en h칬g skattekategori? Hur stor andel av censusdistrikten med h칬g skatt ligger inte i angr칛nsning till Charles River?

::: {.callout-note appearance="minimal"}
# Uppgift 2.3 - Svar

Skriv svaret h칛r.

```{r}
# Write your code here
```
:::

#### 游눩 Uppgift 2.4

Vilka tv친 variabler i datasetet `Boston_census_data` korrelerar mest med `tax_rate`? Beskriv det parvisa sambandet mellan `tax_rate` och vardera av dessa tv친 variabler. 츿r dessa korrelationssamband eller kausala samband?

::: callout-tip
Kom ih친g att korrelation 칛r ett beroendem친tt f칬r *numeriska variabler*.
:::

::: {.callout-note appearance="minimal"}
# Uppgift 2.4 - Svar

Skriv svaret h칛r.

```{r}
# Write your code here
```
:::

## 3. Avst친nd till Fenway park

I detta avsnitt ska ni skapa en ny variabel som m칛ter avst친ndet till Fenway park (stadion d칛r basebollslaget Boston Red Sox spelar sina hemmamatcher). Genom variablerna `latitude` och `longitude` kan vi ber칛kna det s친 kallade cirkelavst친ndet[^6] till Fenway park f칬r varje distrikt. Formeln f칬r cirkelavst친ndet 칛r ganska komplicerad, men den finns implementerad i funktionen `distHaversine()` i R-paketet `geosphere`. F칬ljande kod ber칛knar avst친ndet till Fenway park f칬r varje censusdistrikt och sparar den som en ny variabel `dist_fenway_park` i `Boston_census_data`.

[^6]: Ett avst친nd mellan tv친 punkter uttryckta i latitud och longitud koordinater som tar h칛nsyn till att jorden 칛r rund. Se [h칛r](https://en.wikipedia.org/wiki/Haversine_formula) f칬r detaljer.

```{r}
library(geosphere) # Install if not available
lat_long <- cbind(Boston_census_data$latitude, Boston_census_data$longitude)
fenway_park_lat_long <- c(42.346462, -71.097250) # latitude and longitude for Fenway_park
Boston_census_data$dist_fenway_park <- distHaversine(lat_long, fenway_park_lat_long)
```

Vi kan visualisera Fenway park samt censusdistrikten i en interaktiv karta med hj칛lp av R-paketet `leaflet`. F칬ljande kod visualiserar Fenway park samt censusdistrikten f칬r observationerna 30 och 45.

```{r}
library(leaflet) # Install if not available
Boston_map <- leaflet() %>% 
  addTiles() %>%
  addMarkers(lat = fenway_park_lat_long[1], lng = fenway_park_lat_long[2], popup="Fenway park") %>%
  addMarkers(lat = Boston_census_data$latitude[30], lng = Boston_census_data$longitude[30], popup="Observation 30") %>%
  addMarkers(lat = Boston_census_data$latitude[45], lng = Boston_census_data$longitude[45], popup="Observation 45") 

Boston_map # Show interactive map
```

#### 游눩 Uppgift 3.1

G칬r ett histogram f칬r variabeln `dist_fenway_park`. Vilket av censusdistrikten har l칛ngst respektive kortast avst친nd till Fenway park? Markera ut dessa distrikt i en interaktiv karta tillsammans med Fenway park.

::: callout-tip
N칛r ni vet vad det l칛ngsta respektive kortaste avst친ndet 칛r s친 kan ni anv칛nda `filter()` funktionen f칬r att filtrera `Boston_census_data` p친 ett l칛mpligt s칛tt.
:::

::: {.callout-note appearance="minimal"}
# Uppgift 3.1 - Svar

Skriv svaret h칛r.

```{r}
# Write your code here
```
:::

#### 游눩 Uppgift 3.2

Finns det ett samband mellan `dist_fenway_park` och `median_home_value`?

::: {.callout-note appearance="minimal"}
# Uppgift 3.2 - Svar

Skriv svaret h칛r.

```{r}
# Write your code here
```
:::

#### 游눩 Uppgift 3.3

Finns det ett samband mellan `dist_fenway_park` och `crime_rate`?

::: {.callout-note appearance="minimal"}
# Uppgift 3.3 - Svar

Skriv svaret h칛r.

```{r}
# Write your code here
```
:::

## 4. Enkel linj칛r regression

I detta avsnitt ska ni anpassa och tolka n친gra enkla linj칛ra regressionsmodeller.

#### 游눩 Uppgift 4.1

Anpassa en linj칛r regression med responsvariabel `NOx` och f칬rklarande variabel `employ_dist`. Rita den anpassade regressionslinjen tillsammans med data i en l칛mplig figur. Beskriv resultaten och tolka modellen. Utf칬r en modellvalidering via en residualanalys och kommentera modellens l칛mplighet. Om modellen inte anses l칛mplig, vilka antaganden har inte varit uppfyllda?

::: {.callout-note appearance="minimal"}
# Uppgift 4.1 - Svar

Skriv svaret h칛r.

```{r}
# Write your code here
```
:::

#### 游눩 Uppgift 4.2

Anv칛nd modellen i Uppgift 4.1 f칬r att prediktera genomsnittsutsl칛ppet f칬r observation 10 med `employ_dist`=10.5857 och ber칛kna dess residual.

::: {.callout-note appearance="minimal"}
# Uppgift 4.2 - Svar

Skriv svaret h칛r.

```{r}
# Write your code here
```
:::

#### 游눩 Uppgift 4.3

Anv칛nd Tukeys cirkel f칬r att transformera variablerna i Uppgift 4.1 (avg칬r sj칛lv vilken eller vilka av de tv친 som beh칬ver transformeras). Anpassa en ny linj칛r regression p친 de transformerade data. Utf칬r en modellvalidering (efter transformation) via en residualanalys och kommentera modellens l칛mplighet j칛mf칬rt med modellen i Uppgift 4.1. Plotta den anpassade regressionen i icke-transformerad skala tillsammans med data (ocks친 i icke-transformerad skala) i en l칛mplig figur.

::: callout-tip
T칛nk p친 att ta h칛nsyn till eventuella transformationer!
:::

::: {.callout-note appearance="minimal"}
# Uppgift 4.3 - Svar

Skriv svaret h칛r.

```{r}
# Write your code here
```
:::

#### 游눩 Uppgift 4.4

Anv칛nd modellen i Uppgift 4.3 f칬r att prediktera genomsnittsutsl칛ppet f칬r observation 10 med `employ_dist`=10.5857 och ber칛kna dess residual. Kommentera resultaten j칛mf칬rt med Uppgift 4.2.

::: callout-tip
T칛nk p친 att ta h칛nsyn till eventuella transformationer!
:::

::: {.callout-note appearance="minimal"}
# Uppgift 4.4 - Svar

Skriv svaret h칛r.

```{r}
# Write your code here
```
:::

## 5. Multipel linj칛r regression

I detta avsnitt ska ni studera multipel linj칛ra regression.

#### 游눩 Uppgift 5.1

Anpassa en linj칛r regression med responsvariabel logaritmerad `median_home_value` samt f칬rklarande variabler `lower_stat_pct` och dummy-variabeln `borders_charles`. Tolka koefficienten f칬r `borders_charles`.

::: {.callout-note appearance="minimal"}
# Uppgift 5.1 - Svar

Skriv svaret h칛r.

```{r}
# Write your code here
```
:::

#### 游눩 Uppgift 5.2

Anpassa en linj칛r regression med responsvariabel `NOx` samt f칬rklarande variabler `lower_stat_pct` och dummy-variabeln `borders_charles`. Vad tror ni om den statistiska signifikansen f칬r respektive f칬rklarande variabel?

::: {.callout-note appearance="minimal"}
# Uppgift 5.2 - Svar

Skriv svaret h칛r.

```{r}
# Write your code here
```
:::

#### 游눩 Uppgift 5.3

Anv칛nd modellen i Uppgift 5.1 f칬r att prediktera `median_home_value` f칬r observation 30 och ber칛kna dess residual.

::: callout-tip
T칛nk p친 att ta h칛nsyn till log-transformationen i den anpassade modellen!
:::

::: {.callout-note appearance="minimal"}
# Uppgift 5.3 - Svar

Skriv svaret h칛r.

```{r}
# Write your code here
```
:::

#### 游눩 Uppgift 5.4

Ni ska nu utveckla en prognosmodell f칬r medianhuspriset `median_home_value`. Ni f친r endast v칛lja mellan f칬ljande f칬rklarande variabler samt godtyckliga transformationer av dom (ni f친r 칛ven transformera responsen):

-   `before_1940_p`
-   `crime_rate`
-   `radial_access`
-   `NOx`
-   `dist_fenway_park` (som skapades i Avsnitt 3).

Det finns $2^5 = 32$ olika s칛tt att inkludera de olika f칬rklarande variabler och d칛rmed 32 olika modeller man kan testa, plus i princip hur m친nga som helst om vi ocks친 transformerar. Vi f칬rv칛ntar oss naturligtvis inte att ni g친r igenom varje m칬jlig modell, men vi f칬ruts칛tter att ni testar er fram metodiskt.

F칬r att utv칛rdera mellan olika modeller kan ni anv칛nda justerat R-kvadrat samt korsvalidering med 4 folds. **Sortera inte \``boston_census_data.Rdata` slumpm칛ssigt n칛r ni korsvaliderar (data ligger redan i slumpm칛ssig ordning)**. Dela upp datasetet i fyra delar n칛r ni korsvaliderar (del 1: observationer 1-120, del 2: observationer 121-240, del 3: observationer 241-360, del 4: observationer 361-480).

::: callout-tip
T칛nk p친 att ta h칛nsyn till eventuell transformation av responsvariabeln n칛r ni utf칬r korsvalideringen. Korsvalideringen anv칛nder prediktionen $\hat{y}$ som 칛r prediktionen av $y$. Exempelvis, om ni har valt transformationen $\log(y)$ 칛r modellens prediktion av responsen $\widehat{\log(y)}$. N칛r ni korsvaliderar blir d친 $\hat{y}=\exp\left(\widehat{\log(y)}\right)$ prediktionen av $y$.

Om ni anv칛nder `reg_crossval()` funktionen fr친n kurspaketet `sdakurs` t칛nk d친 p친 tv친 saker:

-   Anv칛nd argumentet `obs_order = 1:480` f칬r att inte sortera data slumpm칛ssigt.
-   Funktionen kan inte hantera en transformerad respons.

Vill man transformera responsen kan man f칬lja korsvalideringsexemplet (med transformerad respons) i Lab 4.
:::

::: {.callout-note appearance="minimal"}
# Uppgift 5.4 - Svar

Skriv svaret h칛r.

```{r}
# Write your code here
```
:::

#### 游눩 Uppgift 5.5

G칬r en residualanalys av den valda modellen i Uppgift 5.3.

::: {.callout-note appearance="minimal"}
# Uppgift 5.5 - Svar

Skriv svaret h칛r.

```{r}
# Write your code here
```
:::

#### 游눩 Uppgift 5.6

Anv칛nd modellen i Uppgift 5.4 f칬r att prediktera medianhuspriset f칬r observationerna i datasetet `Boston_districts_to_predict.RData`. Skriv ut resultatet s친 att vi enkelt kan j칛mf칬ra dina prognoser n칛r vi r칛ttar.

::: callout-tip
T칛nk p친 att ta h칛nsyn till eventuella transformationer av de f칬rklarande variablerna! Om ni har `dist_fenway_park` med i er prognosmodell beh칬ver ni r칛kna ut dess v칛rde f칬r observationerna i datasetet `Boston_districts_to_predict.RData` (genom att anv칛nda latitud och longitud variablerna s친som i Avsnitt 3).
:::

::: {.callout-note appearance="minimal"}
# Uppgift 5.6 - Svar

Skriv svaret h칛r.

```{r}
# Write your code here
```
:::
